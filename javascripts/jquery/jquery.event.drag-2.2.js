/*! 
 * jquery.event.drag - v 2.2
 * Copyright (c) 2010 Three Dub Media - http://threedubmedia.com
 * Open Source MIT License - http://threedubmedia.com/code/license
 */
!function(e){e.fn.drag=function(t,a,n){var o="string"==typeof t?t:"",r=e.isFunction(t)?t:e.isFunction(a)?a:null;return 0!==o.indexOf("drag")&&(o="drag"+o),n=(t==r?a:n)||{},r?this.bind(o,n,r):this.trigger(o)};var t=e.event,a=t.special,n=a.drag={defaults:{which:1,distance:0,not:":input",handle:null,relative:!1,drop:!0,click:!1},datakey:"dragdata",noBubble:!0,add:function(t){var a=e.data(this,n.datakey),o=t.data||{};a.related+=1,e.each(n.defaults,function(e){void 0!==o[e]&&(a[e]=o[e])})},remove:function(){e.data(this,n.datakey).related-=1},setup:function(){if(!e.data(this,n.datakey)){var a=e.extend({related:0},n.defaults);e.data(this,n.datakey,a),t.add(this,"touchstart mousedown",n.init,a),this.attachEvent&&this.attachEvent("ondragstart",n.dontstart)}},teardown:function(){var a=e.data(this,n.datakey)||{};a.related||(e.removeData(this,n.datakey),t.remove(this,"touchstart mousedown",n.init),n.textselect(!0),this.detachEvent&&this.detachEvent("ondragstart",n.dontstart))},init:function(o){if(!n.touched){var r,i=o.data;if(!(0!=o.which&&i.which>0&&o.which!=i.which||e(o.target).is(i.not)||i.handle&&!e(o.target).closest(i.handle,o.currentTarget).length||(n.touched="touchstart"==o.type?this:null,i.propagates=1,i.mousedown=this,i.interactions=[n.interaction(this,i)],i.target=o.target,i.pageX=o.pageX,i.pageY=o.pageY,i.dragging=null,r=n.hijack(o,"draginit",i),!i.propagates)))return r=n.flatten(r),r&&r.length&&(i.interactions=[],e.each(r,function(){i.interactions.push(n.interaction(this,i))})),i.propagates=i.interactions.length,i.drop!==!1&&a.drop&&a.drop.handler(o,i),n.textselect(!1),n.touched?t.add(n.touched,"touchmove touchend",n.handler,i):t.add(document,"mousemove mouseup",n.handler,i),!n.touched||i.live?!1:void 0}},interaction:function(t,a){var o=e(t)[a.relative?"position":"offset"]()||{top:0,left:0};return{drag:t,callback:new n.callback,droppable:[],offset:o}},handler:function(o){var r=o.data;switch(o.type){case!r.dragging&&"touchmove":o.preventDefault();case!r.dragging&&"mousemove":if(Math.pow(o.pageX-r.pageX,2)+Math.pow(o.pageY-r.pageY,2)<Math.pow(r.distance,2))break;o.target=r.target,n.hijack(o,"dragstart",r),r.propagates&&(r.dragging=!0);case"touchmove":o.preventDefault();case"mousemove":if(r.dragging){if(n.hijack(o,"drag",r),r.propagates){r.drop!==!1&&a.drop&&a.drop.handler(o,r);break}o.type="mouseup"}case"touchend":case"mouseup":default:n.touched?t.remove(n.touched,"touchmove touchend",n.handler):t.remove(document,"mousemove mouseup",n.handler),r.dragging&&(r.drop!==!1&&a.drop&&a.drop.handler(o,r),n.hijack(o,"dragend",r)),n.textselect(!0),r.click===!1&&r.dragging&&e.data(r.mousedown,"suppress.click",(new Date).getTime()+5),r.dragging=n.touched=!1}},hijack:function(a,o,r,i,d){if(r){var l,s,c,u={event:a.originalEvent,type:a.type},p=o.indexOf("drop")?"drag":"drop",h=i||0,g=isNaN(i)?r.interactions.length:i;a.type=o,a.originalEvent=null,r.results=[];do if(s=r.interactions[h]){if("dragend"!==o&&s.cancelled)continue;c=n.properties(a,r,s),s.results=[],e(d||s[p]||r.droppable).each(function(i,d){return c.target=d,a.isPropagationStopped=function(){return!1},l=d?t.dispatch.call(d,a,c):null,l===!1?("drag"==p&&(s.cancelled=!0,r.propagates-=1),"drop"==o&&(s[p][i]=null)):"dropinit"==o&&s.droppable.push(n.element(l)||d),"dragstart"==o&&(s.proxy=e(n.element(l)||s.drag)[0]),s.results.push(l),delete a.result,"dropinit"!==o?l:void 0}),r.results[h]=n.flatten(s.results),"dropinit"==o&&(s.droppable=n.flatten(s.droppable)),"dragstart"!=o||s.cancelled||c.update()}while(++h<g);return a.type=u.type,a.originalEvent=u.event,n.flatten(r.results)}},properties:function(e,t,a){var o=a.callback;return o.drag=a.drag,o.proxy=a.proxy||a.drag,o.startX=t.pageX,o.startY=t.pageY,o.deltaX=e.pageX-t.pageX,o.deltaY=e.pageY-t.pageY,o.originalX=a.offset.left,o.originalY=a.offset.top,o.offsetX=o.originalX+o.deltaX,o.offsetY=o.originalY+o.deltaY,o.drop=n.flatten((a.drop||[]).slice()),o.available=n.flatten((a.droppable||[]).slice()),o},element:function(e){return e&&(e.jquery||1==e.nodeType)?e:void 0},flatten:function(t){return e.map(t,function(t){return t&&t.jquery?e.makeArray(t):t&&t.length?n.flatten(t):t})},textselect:function(t){e(document)[t?"unbind":"bind"]("selectstart",n.dontstart).css("MozUserSelect",t?"":"none"),document.unselectable=t?"off":"on"},dontstart:function(){return!1},callback:function(){}};n.callback.prototype={update:function(){a.drop&&this.available.length&&e.each(this.available,function(e){a.drop.locate(this,e)})}};var o=t.dispatch;t.dispatch=function(t){return e.data(this,"suppress."+t.type)-(new Date).getTime()>0?(e.removeData(this,"suppress."+t.type),void 0):o.apply(this,arguments)};var r=t.fixHooks.touchstart=t.fixHooks.touchmove=t.fixHooks.touchend=t.fixHooks.touchcancel={props:"clientX clientY pageX pageY screenX screenY".split(" "),filter:function(t,a){if(a){var n=a.touches&&a.touches[0]||a.changedTouches&&a.changedTouches[0]||null;n&&e.each(r.props,function(e,a){t[a]=n[a]})}return t}};a.draginit=a.dragstart=a.dragend=n}(jQuery);