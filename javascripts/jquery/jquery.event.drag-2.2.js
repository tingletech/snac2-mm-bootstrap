/*! 
 * jquery.event.drag - v 2.2
 * Copyright (c) 2010 Three Dub Media - http://threedubmedia.com
 * Open Source MIT License - http://threedubmedia.com/code/license
 */
!function(e){e.fn.drag=function(t,n,o){var i="string"==typeof t?t:"",r=e.isFunction(t)?t:e.isFunction(n)?n:null;return 0!==i.indexOf("drag")&&(i="drag"+i),o=(t==r?n:o)||{},r?this.bind(i,o,r):this.trigger(i)};var t=e.event,n=t.special,o=n.drag={defaults:{which:1,distance:0,not:":input",handle:null,relative:!1,drop:!0,click:!1},datakey:"dragdata",noBubble:!0,add:function(t){var n=e.data(this,o.datakey),i=t.data||{};n.related+=1,e.each(o.defaults,function(e){void 0!==i[e]&&(n[e]=i[e])})},remove:function(){e.data(this,o.datakey).related-=1},setup:function(){if(!e.data(this,o.datakey)){var n=e.extend({related:0},o.defaults);e.data(this,o.datakey,n),t.add(this,"touchstart mousedown",o.init,n),this.attachEvent&&this.attachEvent("ondragstart",o.dontstart)}},teardown:function(){var n=e.data(this,o.datakey)||{};n.related||(e.removeData(this,o.datakey),t.remove(this,"touchstart mousedown",o.init),o.textselect(!0),this.detachEvent&&this.detachEvent("ondragstart",o.dontstart))},init:function(i){if(!o.touched){var r,a=i.data;if(!(0!=i.which&&a.which>0&&i.which!=a.which||e(i.target).is(a.not)||a.handle&&!e(i.target).closest(a.handle,i.currentTarget).length||(o.touched="touchstart"==i.type?this:null,a.propagates=1,a.mousedown=this,a.interactions=[o.interaction(this,a)],a.target=i.target,a.pageX=i.pageX,a.pageY=i.pageY,a.dragging=null,r=o.hijack(i,"draginit",a),!a.propagates)))return r=o.flatten(r),r&&r.length&&(a.interactions=[],e.each(r,function(){a.interactions.push(o.interaction(this,a))})),a.propagates=a.interactions.length,a.drop!==!1&&n.drop&&n.drop.handler(i,a),o.textselect(!1),o.touched?t.add(o.touched,"touchmove touchend",o.handler,a):t.add(document,"mousemove mouseup",o.handler,a),!o.touched||a.live?!1:void 0}},interaction:function(t,n){var i=e(t)[n.relative?"position":"offset"]()||{top:0,left:0};return{drag:t,callback:new o.callback,droppable:[],offset:i}},handler:function(i){var r=i.data;switch(i.type){case!r.dragging&&"touchmove":i.preventDefault();case!r.dragging&&"mousemove":if(Math.pow(i.pageX-r.pageX,2)+Math.pow(i.pageY-r.pageY,2)<Math.pow(r.distance,2))break;i.target=r.target,o.hijack(i,"dragstart",r),r.propagates&&(r.dragging=!0);case"touchmove":i.preventDefault();case"mousemove":if(r.dragging){if(o.hijack(i,"drag",r),r.propagates){r.drop!==!1&&n.drop&&n.drop.handler(i,r);break}i.type="mouseup"}case"touchend":case"mouseup":default:o.touched?t.remove(o.touched,"touchmove touchend",o.handler):t.remove(document,"mousemove mouseup",o.handler),r.dragging&&(r.drop!==!1&&n.drop&&n.drop.handler(i,r),o.hijack(i,"dragend",r)),o.textselect(!0),r.click===!1&&r.dragging&&e.data(r.mousedown,"suppress.click",(new Date).getTime()+5),r.dragging=o.touched=!1}},hijack:function(n,i,r,a,s){if(r){var l,c,u,d={event:n.originalEvent,type:n.type},f=i.indexOf("drop")?"drag":"drop",p=a||0,h=isNaN(a)?r.interactions.length:a;n.type=i,n.originalEvent=null,r.results=[];do if(c=r.interactions[p]){if("dragend"!==i&&c.cancelled)continue;u=o.properties(n,r,c),c.results=[],e(s||c[f]||r.droppable).each(function(a,s){return u.target=s,n.isPropagationStopped=function(){return!1},l=s?t.dispatch.call(s,n,u):null,l===!1?("drag"==f&&(c.cancelled=!0,r.propagates-=1),"drop"==i&&(c[f][a]=null)):"dropinit"==i&&c.droppable.push(o.element(l)||s),"dragstart"==i&&(c.proxy=e(o.element(l)||c.drag)[0]),c.results.push(l),delete n.result,"dropinit"!==i?l:void 0}),r.results[p]=o.flatten(c.results),"dropinit"==i&&(c.droppable=o.flatten(c.droppable)),"dragstart"!=i||c.cancelled||u.update()}while(++p<h);return n.type=d.type,n.originalEvent=d.event,o.flatten(r.results)}},properties:function(e,t,n){var i=n.callback;return i.drag=n.drag,i.proxy=n.proxy||n.drag,i.startX=t.pageX,i.startY=t.pageY,i.deltaX=e.pageX-t.pageX,i.deltaY=e.pageY-t.pageY,i.originalX=n.offset.left,i.originalY=n.offset.top,i.offsetX=i.originalX+i.deltaX,i.offsetY=i.originalY+i.deltaY,i.drop=o.flatten((n.drop||[]).slice()),i.available=o.flatten((n.droppable||[]).slice()),i},element:function(e){return e&&(e.jquery||1==e.nodeType)?e:void 0},flatten:function(t){return e.map(t,function(t){return t&&t.jquery?e.makeArray(t):t&&t.length?o.flatten(t):t})},textselect:function(t){e(document)[t?"unbind":"bind"]("selectstart",o.dontstart).css("MozUserSelect",t?"":"none"),document.unselectable=t?"off":"on"},dontstart:function(){return!1},callback:function(){}};o.callback.prototype={update:function(){n.drop&&this.available.length&&e.each(this.available,function(e){n.drop.locate(this,e)})}};var i=t.dispatch;t.dispatch=function(t){return e.data(this,"suppress."+t.type)-(new Date).getTime()>0?(e.removeData(this,"suppress."+t.type),void 0):i.apply(this,arguments)};var r=t.fixHooks.touchstart=t.fixHooks.touchmove=t.fixHooks.touchend=t.fixHooks.touchcancel={props:"clientX clientY pageX pageY screenX screenY".split(" "),filter:function(t,n){if(n){var o=n.touches&&n.touches[0]||n.changedTouches&&n.changedTouches[0]||null;o&&e.each(r.props,function(e,n){t[n]=o[n]})}return t}};n.draginit=n.dragstart=n.dragend=o}(jQuery);